{% extends 'templates/_document.twig' %}

{% block content %}
  {% set blog_link = function('get_permalink', function('get_option', 'page_for_posts')) %}
  {% set case_study_link = function('get_post_type_archive_link', 'case_study') %}
  {% set service_link = function('get_post_type_archive_link', 'service') %}
  {% set areas_link = site.link ~ '/areas-covered/' %}

  {% if post.meta('hero_headline') or post.meta('hero_subheadline') %}
    <section class="page-hero hero">
      <div class="container hero-inner page-hero__inner">
        <div class="hero-content">
          {% if post.meta('hero_headline') %}
            <h1>{{ post.meta('hero_headline') }}</h1>
          {% endif %}
          {% if post.meta('hero_subheadline') %}
            <p class="hero-subtitle">{{ post.meta('hero_subheadline') }}</p>
          {% endif %}
          <div class="hero-ctas">
            {% if post.meta('hero_primary_cta_label') %}
              <a href="#contact" class="button">{{ post.meta('hero_primary_cta_label') }}</a>
            {% endif %}
            {% if post.meta('hero_secondary_cta_label') %}
              <a href="{{ service_link|default('/services/') }}" class="button button--outlined">{{ post.meta('hero_secondary_cta_label') }}</a>
            {% endif %}
          </div>
          {% if post.meta('trust_badges') %}
            <div class="hero-trust">
              {% for item in post.meta('trust_badges') %}
                {% if item.badge_name %}
                  <span class="trust-item">
                    {% if item.badge_image %}
                      <img src="{{ function('wp_get_attachment_image_url', item.badge_image, 'full') }}" alt="{{ item.badge_name|e }}" width="20" height="20">
                    {% endif %}
                    {{ item.badge_name }}
                  </span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        </div>
        {% if post.thumbnail %}
          <div class="hero-illustration page-hero__media">
            <img src="{{ post.thumbnail.src|e }}" alt="{{ post.thumbnail.alt|e ?: post.title }}">
          </div>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {% if post.meta('video_testimonials_headline') or post.meta('video_testimonials_note') %}
    <section class="section section--muted">
      <div class="container">
        <header class="section-header">
          {% if post.meta('video_testimonials_headline') %}
            <h2>{{ post.meta('video_testimonials_headline') }}</h2>
          {% endif %}
          {% if post.meta('video_testimonials_note') %}
            <p class="section-intro">{{ post.meta('video_testimonials_note') }}</p>
          {% endif %}
        </header>
      </div>
    </section>
  {% endif %}

  {% if post.meta('services_headline') or post.meta('service_cards') %}
    <section id="services" class="services section">
      <div class="container">
        <header class="section-header">
          {% if post.meta('services_headline') %}
            <h2>{{ post.meta('services_headline') }}</h2>
          {% endif %}
          {% if post.meta('services_intro') %}
            <p class="section-intro">{{ post.meta('services_intro') }}</p>
          {% endif %}
        </header>
        {% if post.meta('service_cards') %}
          <div class="card-grid">
            {% for card in post.meta('service_cards') %}
              <article class="card">
                {% if card.service_name %}
                  <h3 class="card__title">{{ card.service_name }}</h3>
                {% endif %}
                {% if card.service_summary %}
                  <p class="card__meta">{{ card.service_summary }}</p>
                {% endif %}
                {% if card.service_url %}
                  <a href="{{ card.service_url }}" class="button button--text">Learn more</a>
                {% endif %}
              </article>
            {% endfor %}
          </div>
        {% endif %}
        {% if post.meta('services_cta_label') %}
          <p class="section-intro">
            <a href="{{ service_link|default('/services/') }}" class="button button--outlined">{{ post.meta('services_cta_label') }}</a>
          </p>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {% if post.meta('featured_work_headline') or post.meta('featured_work_intro') %}
    <section id="work" class="case-study section section--contrast">
      <div class="container">
        <header class="section-header">
          {% if post.meta('featured_work_headline') %}
            <h2>{{ post.meta('featured_work_headline') }}</h2>
          {% endif %}
          {% if post.meta('featured_work_intro') %}
            <p class="section-intro">{{ post.meta('featured_work_intro') }}</p>
          {% endif %}
        </header>
        {% if case_studies %}
          <div class="card-grid">
            {% for case in case_studies %}
              <article class="card">
                <h3 class="card__title">{{ case.title }}</h3>
                <p class="card__meta">{{ case.excerpt.read_more(false) }}</p>
                <a class="button button--text" href="{{ case.link|e('esc_url') }}">View case study</a>
              </article>
            {% endfor %}
          </div>
        {% endif %}
        {% if post.meta('featured_work_note') %}
          <p class="note">{{ post.meta('featured_work_note') }}</p>
        {% endif %}
        {% if post.meta('featured_work_cta_label') %}
          <p>
            <a href="{{ case_study_link|default('/case-studies/') }}" class="button">{{ post.meta('featured_work_cta_label') }}</a>
          </p>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {% if post.meta('differentiators_headline') or post.meta('differentiators') %}
    <section class="section">
      <div class="container">
        <header class="section-header section-header--center">
          {% if post.meta('differentiators_headline') %}
            <h2>{{ post.meta('differentiators_headline') }}</h2>
          {% endif %}
        </header>
        {% if post.meta('differentiators') %}
          <div class="card-grid">
            {% for diff in post.meta('differentiators') %}
              <article class="card">
                <h3 class="card__title">{{ diff.diff_title }}</h3>
                {% if diff.diff_body %}
                  <p class="card__meta">{{ diff.diff_body }}</p>
                {% endif %}
              </article>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {% if post.meta('testimonials_headline') or post.meta('testimonials_note') %}
    <section class="section section--muted">
      <div class="container">
        <header class="section-header section-header--center">
          {% if post.meta('testimonials_headline') %}
            <h2>{{ post.meta('testimonials_headline') }}</h2>
          {% endif %}
          {% if post.meta('testimonials_note') %}
            <p class="section-intro">{{ post.meta('testimonials_note') }}</p>
          {% endif %}
        </header>
      </div>
    </section>
  {% endif %}

  {% if post.meta('blog_preview_headline') or post.meta('blog_preview_intro') %}
    <section class="section">
      <div class="container">
        <header class="section-header">
          {% if post.meta('blog_preview_headline') %}
            <h2>{{ post.meta('blog_preview_headline') }}</h2>
          {% endif %}
          {% if post.meta('blog_preview_intro') %}
            <p class="section-intro">{{ post.meta('blog_preview_intro') }}</p>
          {% endif %}
        </header>
      </div>
      {{ renderComponent('GridPostsLatest', {'options': {'theme': 'light', 'maxPosts': 3, 'maxColumns': 3}}) }}
      {% if post.meta('blog_preview_note') or post.meta('blog_preview_cta_label') %}
        <div class="container">
          {% if post.meta('blog_preview_note') %}
            <p class="note">{{ post.meta('blog_preview_note') }}</p>
          {% endif %}
          {% if post.meta('blog_preview_cta_label') %}
            <p><a href="{{ blog_link|default('/blog/') }}" class="button button--outlined">{{ post.meta('blog_preview_cta_label') }}</a></p>
          {% endif %}
        </div>
      {% endif %}
    </section>
  {% endif %}

  {% if post.meta('areas_headline') or post.meta('areas_body') %}
    <section class="section section--contrast">
      <div class="container">
        <header class="section-header">
          {% if post.meta('areas_headline') %}
            <h2>{{ post.meta('areas_headline') }}</h2>
          {% endif %}
          {% if post.meta('areas_body') %}
            <p class="section-intro">{{ post.meta('areas_body') }}</p>
          {% endif %}
        </header>
        {% if post.meta('areas_note') %}
          <p class="note">{{ post.meta('areas_note') }}</p>
        {% endif %}
        {% if post.meta('areas_cta_label') %}
          <a href="{{ areas_link }}" class="button button--outlined">{{ post.meta('areas_cta_label') }}</a>
        {% endif %}
      </div>
    </section>
  {% endif %}

  {% if post.meta('final_cta_headline') or post.meta('final_cta_body') %}
    <section id="contact" class="section">
      <div class="container">
        <div class="cta-panel">
          {% if post.meta('final_cta_headline') %}
            <h2>{{ post.meta('final_cta_headline') }}</h2>
          {% endif %}
          {% if post.meta('final_cta_body') %}
            <p>{{ post.meta('final_cta_body') }}</p>
          {% endif %}
          <div class="hero-ctas">
            {% if post.meta('final_cta_primary_label') %}
              <a href="#contact" class="button">{{ post.meta('final_cta_primary_label') }}</a>
            {% endif %}
            {% if post.meta('final_cta_secondary_label') %}
              <a href="{{ site.link }}/contact/" class="button button--outlined">{{ post.meta('final_cta_secondary_label') }}</a>
            {% endif %}
          </div>
          {% if post.meta('final_cta_microcopy') %}
            <p class="cta-panel__microcopy">{{ post.meta('final_cta_microcopy') }}</p>
          {% endif %}
        </div>
      </div>
    </section>
  {% endif %}
{% endblock %}
